<html>
	<head>
		<title>EA Hub Prometheus Server Status</title>
		<link rel="stylesheet" type="text/css" href="style.css" />
		<link rel="icon" href="favicon.ico" type="image/x-icon" />
		<meta http-equiv="refresh" content="120" />
	</head>
	<body>
		<div id="global_user_count" class="headline">
		        0 online on <span class="site">eahub.eu</span> Prometheus ad hoc server
		</div>
		<div class="navigation">
		        <a class="setuplink" href="https://github.com/Kethen/aemu/releases/latest" target="_blank">PSP/Vita Setup</a>
				<a class="setuplink" href="https://github.com/Kethen/ppsspp/releases/latest" target="_blank">PPSSPP Setup</a>
				<a class="discordlink" href="https://discord.gg/fwrQHHxrQQ" target="_blank">EA Hub Discord</a>
				<a class="discordlink" href="https://discord.gg/wxeGVkM" target="_blank">PSP Online Discord</a>
		</div>
		<div id="games">
		</div>
		<script>
			function render_data(data){
				let num_users = 0;
				let target = document.getElementById("games");
				let new_html = ""
				for(const game of data.games){
					new_html += `
						<div class="gametitle">
							<table class="splitter">
								<tr>
									<td class="left">
										${game.name}
									</td>
									<td class="right">
										<span class="usercount">
											<span class="good">${game.usercount} Total</span>
										</span>
									</td>
								<tr>
								<tr class="bottom">
									<td>
										<table class="groups">
											<tr>
												<th>Group</th>
												<th>User Count</th>
												<th>Players</th>
											</tr>
					`;
					for (const group of game.groups){
						new_html += `
							<tr>
								<td>${group.name}</td>
								<td>${group.usercount}</td>
								<td>
						`;

						num_users += Number(group.usercount);

						new_html += `<table>
										<tr>
											<th>Nickname</th>
											<th>PDP ports</th>
											<th>PTP ports</th>
										</tr>
						`

						for(const user of group.users){
							new_html += `<tr>`;
							new_html += `<td>${user.name}</td>`
							new_html += `<td>`
								for(const port of user.pdp_ports){
									if (port != user.pdp_ports[user.pdp_ports.length - 1]){
										new_html += `${port} `;
									}else{
										new_html += `${port}`;
									}
								}
							new_html += `</td>`
							new_html += `<td>`
							for(const port of user.ptp_ports){
								if (port != user.ptp_ports[user.ptp_ports.length - 1]){
									new_html += `${port} `;
								}else{
									new_html += `${port}`;
								}
							}
							new_html += `</td>`;
							new_html += `<tr>`;
						}

						new_html += `</table>`

						new_html += `
								</td>
							</tr>
						`;
					}

					new_html += `
										</table>
									</td>
								</tr>
							</table>
						</div>
			
					`;
				}

				target.innerHTML = new_html;
				document.getElementById("global_user_count").innerHTML = `${num_users} online on <span class="site">eahub.eu</span> Prometheus ad hoc server`;
			}

			function update_games(){
				let fetcher = fetch("data.json")
				fetcher.then((res) => {
					res.text().then((str) => {
						try{
							let data = JSON.parse(str);
							render_data(data);
						}catch(err){
							console.log(`failed parsing data, ${err}`);
						}
					});
				});
			}
			setInterval(update_games, 1000 * 120);
			update_games();
		</script>
		<div class="footer">
        Â© 2012 Team PRO (<a href="https://github.com/MrColdbird" target="_blank">MrColdbird</a>), maintained by <a href="https://github.com/Kethen" target="_blank">Kethen</a> - Hosted by EA Hub (<a href="https://github.com/a-blondel" target="_blank">a-blondel</a>)
		</div>
	</body>
</html>
